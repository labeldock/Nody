<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=2">
  <title>Command Zone</title>
  <link rel="stylesheet" href="resources/css/bootstrap.min.css">
  <link rel="stylesheet" href="resources/css/nody.css">
  <link rel="stylesheet" href="resources/css/application.css">
  <link rel="stylesheet" href="resources/css/bootstrap-slider.css">
  <style>
  .wrapper {
	  background-color:#45454c;
  }
  </style>
</head>
<body>
	<p>시작과</p>
	<div class='wrapper'>
		<canvas></canvas>
	</div>
	
	<p>끝</p>
	
	<script src="../js/nody.js"></script>
	<script src="resources/js/jquery-1.11.1.min.js"></script>
	<script src="resources/js/bootstrap.min.js"></script>
	<script src="resources/js/fabric.js"></script>
	<script>
		
		var needWeatherChart = function(container,tempDatas){
			var canvasHeight  = 200;
			var pointWidth    = 15;
			var lineWidth     = 1;
			var lowValue      = _NFArray(tempDatas).getSortFirst();
			var highValue     = _NFArray(tempDatas).getSortLast();
			var gabValue      = highValue - lowValue;
			var fillColor     = '#8f8f8f';
			var paddingTop    = 50;
			var paddingSide   = 20;
			var labelOffetTop = 35;
			
			container = FIND(container,0);
			var chartID = ELUNIQUEID(container);
			var parent = container.parentNode;
			var canvas = new fabric.Canvas(chartID,{ height:canvasHeight });
			
			
			
			var dataPoints = DATAMAP(tempDatas,function(temp){
				var currentFillColor = ((temp == highValue || temp == lowValue) ? "#fff" : fillColor);
				var rect = new fabric.Circle({
					radius:pointWidth / 2,
					top:canvasHeight - pointWidth,
					fill: currentFillColor,
					selectable:true,
					hasControls:false,
					hasBorders:false
				});
			
				return rect;
			});
		
			var dataLines = TIMESMAP(dataPoints.length - 1,function(){
				var line = new fabric.Line([0,0,0,0],{
					fill: fillColor,
					stroke: fillColor,
					strokeWidth: lineWidth,
					selectable: false
				});
				return line;
			});
			
			var dataLebels = DATAMAP(tempDatas,function(temp){
				
				var currentFillColor = 
				temp == highValue ? '#f55056': 
				temp == lowValue  ? '#5492df': fillColor;
				
				var text = new fabric.Text(temp+'℃',{
					fontFamily: 'Helvetica Neue',
					fontWeight: '300',
					fontSize: 22,
					fill:currentFillColor,
					textAlign:'center',
					selectable:true,
					hasControls:false,
					hasBorders:false
				});
				return text;
			});
			
			var dataPosFix = function(){
				var canvasWidth  = canvas.getWidth();
				var canvasHeight = canvas.getHeight();
				var pointLength  = ((canvasWidth - paddingSide * 2)  - pointWidth) / (dataPoints.length - 1);
				
				var gabHeight    = (canvasHeight - pointWidth - paddingTop) / gabValue;
				DATAEACH(tempDatas,function(data,i){
					dataPoints[i].setLeft((pointLength * i) + paddingSide);
					dataLebels[i].setLeft((pointLength * i) - (dataLebels[i].getWidth() / 3) + paddingSide);
					
					var heightTo = canvasHeight - ((data - lowValue) * gabHeight) - (paddingTop/2);
					
					dataPoints[i].setTop( heightTo );
					dataLebels[i].setTop( heightTo - labelOffetTop );
					
					//rect.setTop();
				});
			
				DATAEACH(dataLines,function(line,i){
					line.set({
						'x1':dataPoints[i].getLeft() + (pointWidth / 2) - (lineWidth / 2),
						'y1':dataPoints[i].getTop() + (pointWidth / 2) - (lineWidth / 2),
						'x2':dataPoints[i+1].getLeft() + (pointWidth / 2) - (lineWidth / 2),
						'y2':dataPoints[i+1].getTop() + (pointWidth / 2) - (lineWidth / 2)
					});
				});
			};
		
			new NFResize(parent,function(e,o){
				var setWidth = o.width();
				canvas.setWidth( setWidth );
				dataPosFix();
			},true);
			
			DATAEACH(dataLines,function(line){ canvas.add(line); });
			DATAEACH(dataPoints,function(rect){ canvas.add(rect); });
			DATAEACH(dataLebels,function(text){ canvas.add(text); });
		}
		
		needWeatherChart('canvas',[23,25,23,22,24,25,26,28,27,24,22]);
		
	</script>	
</body>
</html>